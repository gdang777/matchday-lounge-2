# MatchDay Lounge — Data Connect Read Queries (PostgreSQL)
# v2.0 — FIFA World Cup 2026 Edition

# ── Venues ────────────────────────────────────────────────────────────────────

query ListVenues($city: String) @auth(level: PUBLIC) {
  venues(where: { city: { eq: $city } }, orderBy: { name: ASC }) {
    id
    name
    slug
    description
    address
    neighborhood
    city
    province
    cuisineType
    priceRange
    logoUrl
    coverImageUrl
    isVerified
    isFanVenue
    boostTier
    latitude
    longitude
  }
}

query GetVenueBySlug($slug: String!) @auth(level: PUBLIC) {
  venue(key: { slug: $slug }) {
    id
    name
    slug
    description
    address
    neighborhood
    city
    province
    cuisineType
    priceRange
    capacity
    websiteUrl
    phoneNumber
    googleMapsUrl
    logoUrl
    coverImageUrl
    openingHours
    isVerified
    isFanVenue
    boostTier
    latitude
    longitude
    promotions {
      id
      title
      description
      type
      dealType
      daysOfWeek
      startTime
      endTime
      startsAt
      expiresAt
      isActive
      imageUrl
    }
  }
}

query ListFeaturedVenues($city: String!) @auth(level: PUBLIC) {
  venues(
    where: {
      city: { eq: $city }
      boostTier: { in: [FEATURED, PREMIUM] }
    }
    orderBy: { boostTier: DESC }
  ) {
    id
    name
    slug
    neighborhood
    logoUrl
    coverImageUrl
    isVerified
    isFanVenue
    boostTier
    latitude
    longitude
  }
}

query SearchVenues(
  $city: String!
  $neighborhood: String
  $cuisineType: String
) @auth(level: PUBLIC) {
  venues(
    where: {
      city: { eq: $city }
      neighborhood: { eq: $neighborhood }
      cuisineType: { eq: $cuisineType }
    }
    orderBy: { boostTier: DESC }
  ) {
    id
    name
    slug
    description
    address
    neighborhood
    city
    cuisineType
    priceRange
    logoUrl
    coverImageUrl
    isVerified
    isFanVenue
    boostTier
    latitude
    longitude
  }
}

# ── Happy Hours / Promotions ─────────────────────────────────────────────────

query ListActivePromotions($city: String) @auth(level: PUBLIC) {
  promotions(
    where: {
      isActive: { eq: true }
      approvalStatus: { eq: APPROVED }
      venue: { city: { eq: $city } }
    }
    orderBy: { startsAt: DESC }
    limit: 50
  ) {
    id
    title
    description
    type
    dealType
    daysOfWeek
    startTime
    endTime
    imageUrl
    startsAt
    expiresAt
    venue {
      id
      name
      slug
      neighborhood
      city
      logoUrl
      boostTier
      latitude
      longitude
      googleMapsUrl
    }
  }
}

query ListHappyHours($city: String!) @auth(level: PUBLIC) {
  promotions(
    where: {
      isActive: { eq: true }
      type: { eq: HAPPY_HOUR }
      approvalStatus: { eq: APPROVED }
      venue: { city: { eq: $city } }
    }
    orderBy: { startsAt: DESC }
    limit: 50
  ) {
    id
    title
    description
    dealType
    daysOfWeek
    startTime
    endTime
    imageUrl
    venue {
      id
      name
      slug
      neighborhood
      city
      logoUrl
      boostTier
      latitude
      longitude
      googleMapsUrl
    }
  }
}

query ListPromotionsByVenue($venueId: UUID!) @auth(level: PUBLIC) {
  promotions(
    where: { venueId: { eq: $venueId }, isActive: { eq: true } }
    orderBy: { startsAt: DESC }
  ) {
    id
    title
    description
    type
    dealType
    daysOfWeek
    startTime
    endTime
    imageUrl
    startsAt
    expiresAt
    redemptionLimit
    redemptionCount
  }
}

# ── Pending Review Queue (Admin) ─────────────────────────────────────────────

query ListPendingPromotions @auth(level: USER_EMAIL_VERIFIED) {
  promotions(
    where: { approvalStatus: { eq: PENDING } }
    orderBy: { createdAt: ASC }
  ) {
    id
    title
    description
    type
    dealType
    source
    sourceUrl
    approvalStatus
    createdAt
    venue {
      id
      name
      city
      neighborhood
    }
  }
}

# ── Subscriptions ─────────────────────────────────────────────────────────────

query GetMySubscription($userId: UUID!) @auth(level: USER_EMAIL_VERIFIED) {
  subscription(key: { userId: $userId }) {
    id
    plan
    status
    currentPeriodStart
    currentPeriodEnd
    cancelledAt
  }
}

# ── Users ─────────────────────────────────────────────────────────────────────

query GetUserByFirebaseUid($firebaseUid: String!) @auth(level: USER_EMAIL_VERIFIED) {
  users(where: { firebaseUid: { eq: $firebaseUid } }) {
    id
    displayName
    email
    role
    avatarUrl
    city
  }
}

# ── Boosts ────────────────────────────────────────────────────────────────────

query ListActiveBoosts($city: String) @auth(level: USER_EMAIL_VERIFIED) {
  boosts(
    where: { status: { eq: ACTIVE }, targetCity: { eq: $city } }
    orderBy: { tier: DESC }
  ) {
    id
    tier
    status
    startsAt
    expiresAt
    venue {
      id
      name
      slug
      city
      neighborhood
    }
  }
}

# ── Audit Log ─────────────────────────────────────────────────────────────────

query ListAuditLogs @auth(level: USER_EMAIL_VERIFIED) {
  auditLogs(orderBy: { createdAt: DESC }, limit: 100) {
    id
    action
    targetType
    targetId
    details
    createdAt
    adminUser {
      displayName
      email
    }
  }
}
